<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™¾åˆ†ä½æ•¸äº’å‹•å­¸ç¿’å·¥å…· (Pâ‚–)</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
        }
        /* ç¢ºä¿æ»‘æ¡¿æ¨£å¼åœ¨ä¸åŒç€è¦½å™¨ä¸­ä¸€è‡´ */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #cbd5e1;
            border-radius: 5px;
            margin: 10px 0;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1e40af; /* è—è‰² */
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }

        /* NEW: æ•¸æ“šé»å®¹å™¨ - ç§»é™¤æ»¾å‹•æ¢ï¼Œå…è¨±å‚ç›´å¢é•· */
        #dataWrapper {
            max-height: none; 
            overflow: visible; /* ç¢ºä¿æ²’æœ‰æ»¾å‹•æ¢ */
            padding: 1rem;
            border-radius: 8px;
            background-color: #ffffff;
        }

        /* NEW: æ•¸æ“šé …å®¹å™¨ (æ¯å€‹ Rank/Value çµ„) æ¨£å¼ */
        .data-item-container {
            width: 80px; /* å›ºå®šçš„å¯¬åº¦è®“æ¯å€‹æ•¸æ“šçµ„ä»¶çœ‹èµ·ä¾†åƒä¸€å€‹å°å¡ç‰‡ */
            padding: 8px 0;
            border-radius: 8px;
            background-color: #f9fafb;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        /* æ’åæ¨£å¼ */
        .data-rank {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* text-gray-500 */
            margin-bottom: 2px;
        }
        
        /* æ•¸å€¼æ¨£å¼ */
        .data-point {
            display: block; 
            padding: 2px 4px;
            border-radius: 4px;
            background-color: transparent; 
            font-weight: 600;
            font-size: 0.875rem; /* text-sm */
            color: #333;
            transition: all 0.2s ease;
            cursor: default;
            margin: 0; 
        }
        
        /* é«˜äº®æ¨£å¼ - æ‡‰ç”¨åœ¨æ•´å€‹å®¹å™¨ */
        .highlighted {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-color: #38a169;
        }
        /* é«˜äº®æ¨£å¼ - æ‡‰ç”¨åœ¨æ•¸å€¼ä¸Š */
        .highlighted .data-point {
            background-color: #38a169; /* ç¶ è‰² */
            color: white;
        }

        /* ç§»é™¤èˆŠæœ‰æ°´å¹³è¡¨æ ¼çš„æ¨£å¼ (ä¸å†éœ€è¦) */
    </style>
</head>
<body class="p-4 md:p-8 max-w-5xl mx-auto">

    <!-- æ¨™é¡Œå·²æ›´æ–°ç‚º Pâ‚– -->
    <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b-2 pb-2">ç™¾åˆ†ä½æ•¸äº’å‹•å­¸ç¿’å·¥å…· (Pâ‚–)</h1>

    <!-- 1. èªªæ˜å€ - æ–°å¢ç™¾åˆ†ä½æ•¸çš„ä½œç”¨è§£é‡‹ -->
    <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-800 p-4 rounded-lg mb-6">
        <p class="font-semibold mb-2">ğŸ“Š å­¸ç¿’ç›®æ¨™ï¼šç†è§£ Pâ‚– åŠƒåˆ†æ•¸æ“šé›†çš„æ„ç¾©</p>

        <!-- æ–°å¢: ç™¾åˆ†ä½æ•¸åœ¨æº«åº¦åˆ†æä¸­çš„ä½œç”¨ -->
        <p class="mt-4 font-semibold text-blue-900">ğŸ” ç™¾åˆ†ä½æ•¸åœ¨æº«åº¦åˆ†æä¸­çš„ä½œç”¨ï¼š</p>
        <p class="mb-4 text-sm">
            åœ¨åˆ†ææº«åº¦æ•¸æ“šæ™‚ï¼Œç™¾åˆ†ä½æ•¸ï¼ˆPâ‚–ï¼‰èƒ½å¹«åŠ©æˆ‘å€‘äº†è§£æº«åº¦åˆ†ä½ˆçš„æ¥µç«¯å’Œå¸¸æ…‹ã€‚ä¾‹å¦‚ï¼š
        </p>
        <ul class="list-disc list-inside ml-4 text-sm">
            <li>**Pâ‚‰â‚… (ç¬¬ 95 ä½æ•¸)**ï¼šä»£è¡¨åªæœ‰ 5% çš„æ™‚é–“æº«åº¦æ¯”é€™å€‹å€¼é«˜ï¼Œå¯ç”¨ä¾†è¨­å®šé«˜æº«è­¦æˆ’ç·šã€‚</li>
            <li>**Pâ‚…â‚€ (ç¬¬ 50 ä½æ•¸ / ä¸­ä½æ•¸)**ï¼šä»£è¡¨æ•¸æ“šé›†çš„ã€Œå…¸å‹ã€æº«åº¦ã€‚</li>
            <li>**Pâ‚… (ç¬¬ 5 ä½æ•¸)**ï¼šä»£è¡¨åªæœ‰ 5% çš„æ™‚é–“æº«åº¦æ¯”é€™å€‹å€¼ä½ï¼Œå¯ç”¨ä¾†è¨­å®šä½æº«è­¦æˆ’ç·šã€‚</li>
        </ul>
        <!-- çµæŸæ–°å¢ -->

        <p class="mt-4">è«‹æ‹–æ›³ä¸‹æ–¹çš„ã€Œç™¾åˆ†ä½æ•¸ kã€æ»‘æ¡¿ï¼ˆ0 åˆ° 100ï¼‰ã€‚ç•¶æ‚¨é¸æ“‡ä¸€å€‹ç™¾åˆ†ä½æ•¸ Pâ‚– æ™‚ï¼Œç³»çµ±æœƒï¼š</p>
        <ul class="list-disc list-inside ml-4 mt-2">
            <li>è¨ˆç®—å‡ºå°æ‡‰çš„ **ç™¾åˆ†ä½æ•¸æ•¸å€¼ (Pâ‚– å€¼)**ã€‚</li>
            <li>åœ¨æ’åºå¾Œçš„æ•¸æ“šä¸­ï¼Œ**é«˜äº®**é¡¯ç¤ºæ‰€æœ‰ä½æ–¼æˆ–ç­‰æ–¼è©² Pâ‚– å€¼çš„æ•¸æ“šé»ã€‚</li>
        </ul>
    </div>

    <!-- 2. æ»‘æ¡¿æ§åˆ¶å€ -->
    <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
        <label for="percentileSlider" class="block text-lg font-semibold mb-2">
            æ‹–æ›³è¨­å®šç™¾åˆ†ä½æ•¸ kï¼š
        </label>
        <input type="range" id="percentileSlider" min="0" max="100" value="50"> 
        <div class="flex justify-between text-sm text-gray-600 mt-2">
            <!-- Pâ‚€ å’Œ Pâ‚â‚€â‚€ ä¿æŒ Unicode ä¸‹æ¨™ -->
            <span>Pâ‚€ (æœ€å°å€¼)</span>
            <span id="currentK" class="text-xl font-bold text-blue-600">Pâ‚…â‚€</span>
            <span>Pâ‚â‚€â‚€ (æœ€å¤§å€¼)</span>
        </div>

        <div id="resultBox" class="mt-4 p-3 bg-indigo-50 border border-indigo-200 rounded-lg">
            <p class="text-indigo-800"><strong id="percentileValue" class="text-2xl font-extrabold mr-2">--</strong></p>
            <p class="text-sm mt-1 text-indigo-700" id="interpretation">è«‹æ‹–æ›³æ»‘æ¡¿ä»¥æŸ¥çœ‹çµæœã€‚</p>
        </div>
    </div>

    <!-- 3. æ•¸æ“šå‘ˆç¾å€ (å·²ä¿®æ”¹ç‚ºéŸ¿æ‡‰å¼ç¶²æ ¼) -->
    <div class="bg-white p-6 rounded-xl shadow-lg">
        <!-- æº«åº¦ç¬¦è™Ÿå·²æ›´æ–°ç‚º Â°C -->
        <h2 class="text-xl font-semibold mb-3">æ’åºå¾Œçš„æº«åº¦æ•¸æ“š (Â°C)</h2>
        <!-- ä½¿ç”¨ Flexbox æ­é… flex-wrap å¯¦ç¾å®Œæ•´é¡¯ç¤ºï¼Œé¿å…æ»¾å‹•æ¢ -->
        <div id="dataWrapper" class="flex flex-wrap gap-3 justify-start p-4 border border-gray-200 rounded-lg bg-gray-50">
            <!-- æ•¸æ“šé»å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
        <p class="text-sm mt-3 text-gray-500">
            æ•¸æ“šç¸½æ•¸ N: <span id="dataCount">--</span> ç­† (å·²å¾å°åˆ°å¤§æ’åˆ—)
        </p>
    </div>
    
    <!-- 4. åŸå§‹è¼¸å…¥æ•¸æ“šå€ -->
    <div class="bg-white p-6 rounded-xl shadow-lg mt-6">
        <button id="toggleRawData" class="text-lg font-semibold text-gray-700 w-full text-left py-2 flex justify-between items-center hover:text-blue-600 transition" onclick="toggleRawData()">
            é»æ“ŠæŸ¥çœ‹åŸå§‹è¼¸å…¥æ•¸æ“š (N=28) 
            <span id="toggleIcon">â–¼</span>
        </button>
        <div id="rawInputData" class="hidden mt-3 p-4 bg-gray-50 border border-gray-200 rounded-lg max-h-48 overflow-y-auto text-sm">
            <p class="font-mono text-gray-700 break-words" id="rawDataList"></p>
        </div>
    </div>

<script>
    // åŸå§‹æº«åº¦æ•¸æ“š
    const rawData = [
        32.00, 32.00, 35.00, 33.00, 33.00, 33.00, 29.00, 33.00, 
        33.00, 33.00, 32.00, 32.00, 32.00, 32.00, 33.00, 32.00, 
        32.00, 32.00, 33.00, 33.00, 33.00, 32.00, 31.00, 31.00, 
        31.00, 31.00, 30.00, 30.00
    ];

    // 1. æ’åºæ•¸æ“šä¸¦è¨ˆç®—ç¸½æ•¸ N
    const sortedData = [...rawData].sort((a, b) => a - b);
    const DATA_COUNT = sortedData.length;

    // Helper function to convert number to Unicode subscript (e.g., 50 -> â‚…â‚€)
    function toUnicodeSubscript(n) {
        return n.toString().split('').map(digit => {
            switch (digit) {
                case '0': return 'â‚€';
                case '1': return 'â‚';
                case '2': return 'â‚‚';
                case '3': return 'â‚ƒ';
                case '4': return 'â‚„';
                case '5': return 'â‚…';
                case '6': return 'â‚†';
                case '7': return 'â‚‡';
                case '8': return 'â‚ˆ';
                case '9': return 'â‚‰';
                default: return digit;
            }
        }).join('');
    }

    // 2. æ¸²æŸ“æ•¸æ“šé»åˆ° HTML (å·²æ›´æ–°ç‚ºéŸ¿æ‡‰å¼ç¶²æ ¼ä½ˆå±€)
    function renderDataPoints() {
        // æ›´æ–°é¡¯ç¤ºçš„æ•¸æ“šç¸½æ•¸
        document.getElementById('dataCount').textContent = DATA_COUNT;
        
        const dataWrapper = document.getElementById('dataWrapper');
        dataWrapper.innerHTML = ''; // æ¸…ç©ºå…§å®¹

        sortedData.forEach((temp, index) => {
            
            // å‰µå»ºåŒ…å«æ’åå’Œæ•¸å€¼çš„å®¹å™¨
            const itemContainer = document.createElement('div');
            itemContainer.className = 'data-item-container';
            itemContainer.id = `dp-container-${index}`; // è¨­ç½®å®¹å™¨ ID
            
            // æ’å (Rank)
            const rankLabel = document.createElement('div');
            rankLabel.className = 'data-rank';
            rankLabel.textContent = `Rank ${index + 1}`; 
            
            // æ•¸å€¼ (Value)
            const point = document.createElement('span');
            point.className = 'data-point';
            point.id = `dp-${index}`; // è¨­ç½® ID æ–¹ä¾¿é«˜äº®
            point.textContent = temp.toFixed(2);
            
            itemContainer.appendChild(rankLabel);
            itemContainer.appendChild(point);
            dataWrapper.appendChild(itemContainer);
        });
        
        // æ¸²æŸ“åŸå§‹æ•¸æ“šæ¸…å–®åˆ°å¯å±•é–‹å€
        const rawDataListElement = document.getElementById('rawDataList');
        rawDataListElement.textContent = rawData.map(d => d.toFixed(2)).join(', ');
    }

    // åˆ‡æ›åŸå§‹æ•¸æ“šå¯è¦‹æ€§çš„å‡½æ•¸
    function toggleRawData() {
        const rawDataContainer = document.getElementById('rawInputData');
        const toggleIcon = document.getElementById('toggleIcon');
        if (rawDataContainer.classList.contains('hidden')) {
            rawDataContainer.classList.remove('hidden');
            toggleIcon.textContent = 'â–²';
        } else {
            rawDataContainer.classList.add('hidden');
            toggleIcon.textContent = 'â–¼';
        }
    }


    // 3. ç™¾åˆ†ä½æ•¸è¨ˆç®—æ ¸å¿ƒå‡½æ•¸ (R-6/N+1 æ–¹æ³• - ä¿æŒä¸è®Š)
    function calculatePercentile(k) {
        if (k === 0) return sortedData[0];
        if (k === 100) return sortedData[DATA_COUNT - 1];

        const L = (k / 100) * (DATA_COUNT + 1);
        const j = Math.floor(L); 
        const g = L - j;

        if (j < 1) return sortedData[0];
        if (j >= DATA_COUNT) return sortedData[DATA_COUNT - 1]; 

        if (g === 0) {
            return sortedData[j - 1]; 
        } else {
            const X_j = sortedData[j - 1]; 
            const X_j_plus_1 = sortedData[j]; 

            return X_j + g * (X_j_plus_1 - X_j);
        }
    }

    // 4. æ›´æ–° UI å’Œé«˜äº®
    function updatePercentile(k) {
        k = parseInt(k);

        // 1. æ›´æ–°æ»‘æ¡¿é¡¯ç¤º (ä½¿ç”¨ Unicode ä¸‹æ¨™)
        document.getElementById('currentK').textContent = `P${toUnicodeSubscript(k)}`;

        // 2. è¨ˆç®— P_k å€¼
        const pkValue = calculatePercentile(k);
        const pkValueFormatted = pkValue.toFixed(2);

        // --- ğŸ¯ æ ¼å¼: ï½˜ï½˜ä½æ•¸ = ï½˜ï½˜ Â°C ---
        document.getElementById('percentileValue').textContent = `${k}ä½æ•¸ = ${pkValueFormatted} Â°C`;

        // 3. æ›´æ–°è§£é‡‹æ–‡å­—
        // --- ğŸ¯ æ ¼å¼: é€™è¡¨ç¤ºæœ‰ï½˜ï½˜% çš„æº«åº¦å°æ–¼æˆ–ç­‰æ–¼ ï½˜ï½˜ Â°Cã€‚ ---
        let interpretationText = `é€™è¡¨ç¤ºæœ‰ ${k}% çš„æº«åº¦å°æ–¼æˆ–ç­‰æ–¼ ${pkValueFormatted} Â°Cã€‚`;

        // å¯é¸ï¼šå°æ–¼ç‰¹æ®Šåˆ†ä½æ•¸ï¼ˆå››åˆ†ä½æ•¸ï¼‰ï¼Œæ·»åŠ é¡å¤–èªªæ˜ (ä½¿ç”¨ Unicode ä¸‹æ¨™)
        if (k === 50) {
            interpretationText += ` (é€™æ˜¯æ•¸æ“šçš„ä¸­ä½æ•¸ Qâ‚‚)`;
        } else if (k === 25) {
            interpretationText += ` (é€™æ˜¯æ•¸æ“šçš„ä¸‹å››åˆ†ä½æ•¸ Qâ‚)`;
        } else if (k === 75) {
            interpretationText += ` (é€™æ˜¯æ•¸æ“šçš„ä¸Šå››åˆ†ä½æ•¸ Qâ‚ƒ)`;
        }

        document.getElementById('interpretation').textContent = interpretationText;

        // 4. æ•¸æ“šé»é«˜äº® (é«˜äº®å…¶çˆ¶å®¹å™¨)
        const dataPoints = document.querySelectorAll('.data-point');
        const dataItemContainers = document.querySelectorAll('.data-item-container');

        // Reset all highlighting
        dataItemContainers.forEach(container => container.classList.remove('highlighted'));

        dataPoints.forEach((point) => {
            const temp = parseFloat(point.textContent);
            
            if (temp <= pkValue) {
                // Highlighting the parent container
                point.closest('.data-item-container').classList.add('highlighted');
            }
        });

        // 5. æ»¾å‹•é‚è¼¯å·²ç§»é™¤ï¼Œå› ç‚ºä¸å†æœ‰æ°´å¹³æ»¾å‹•æ¢
    }

    // 5. åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼ - åœ¨è¦–çª—è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
    window.onload = function() {
        // ç¢ºä¿å‡½æ•¸åœ¨å…¨å±€ä½œç”¨åŸŸä¸­
        window.toggleRawData = toggleRawData;
        
        renderDataPoints();
        
        // ç²å–æ»‘æ¡¿å…ƒç´ 
        const slider = document.getElementById('percentileSlider');

        // ä»¥ç¨‹å¼åŒ–æ–¹å¼æ·»åŠ äº‹ä»¶ç›£è½å™¨
        slider.addEventListener('input', (event) => {
            updatePercentile(event.target.value);
        });

        // åˆå§‹è¨­å®šç‚ºä¸­ä½æ•¸ P50
        updatePercentile(50); 
    };
</script>

</body>
</html>